- name: Centos 9 signing keys
  when: false   # https://github.com/ansible/ansible/issues/86157
  ansible.builtin.rpm_key:
    state: present
    # Believe it ot not, the one inside the RPM (below) is signed with SHA-1 ðŸ¤¦â€â™‚ï¸
    key: https://www.centos.org/keys/RPM-GPG-KEY-CentOS-Official-SHA256

- name: CentOS 9 stream
  dnf:
    name:
      - https://mirror.rackspace.com/centos-stream/9-stream/BaseOS/x86_64/os/Packages/centos-gpg-keys-9.0-30.el9.noarch.rpm
      - https://mirror.rackspace.com/centos-stream/9-stream/BaseOS/x86_64/os/Packages/centos-stream-repos-9.0-30.el9.noarch.rpm

- name: Disable all CentOS repositories
  register: _disable_script
  changed_when: >-
    "sed" in _disable_script.stderr
  shell:
    cmd: |
      set -e -x
      grep -q "enabled=1" /etc/yum.repos.d/centos*.repo || exit 0

      sed -i.ansiblebak -e 's|enabled=1|enabled=0|g' /etc/yum.repos.d/centos*.repo

- name: Un-Cockpit
  dnf:
    state: absent
    name:
      - cockpit
      - cockpit-ws
